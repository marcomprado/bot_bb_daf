# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Essential Commands

### Development
```bash
# Install dependencies
pip install -r requirements.txt

# Run GUI interface (recommended)
python gui_main.py

# Run command line version
python main.py

# Run parallel processing
python main_parallel.py [cidade_file.txt]

# Check dependencies
python main.py  # includes dependency verification
```

### Virtual Environment
```bash
# Create virtual environment
python -m venv venv     # Windows
python3 -m venv venv    # macOS/Linux

# Activate virtual environment
source venv/bin/activate    # macOS/Linux
venv\Scripts\activate       # Windows
```

## Architecture Overview

This is a Python web scraping automation system for extracting FPM (Fundo de Participação dos Municípios) data from Banco do Brasil's website.

### Core Components

- **WebScrapingBot** (`classes/web_scraping_bot.py`): Main Selenium automation engine
- **DataExtractor** (`classes/data_extractor.py`): HTML parsing and Excel generation with formatting
- **DateCalculator** (`classes/date_calculator.py`): Automatic date calculation (defaults to last month)
- **FileManager** (`classes/file_manager.py`): City list loading and validation
- **CitySplitter** (`classes/city_splitter.py`): Parallel processing city distribution

### Entry Points

- **gui_main.py**: Modern CustomTkinter GUI interface (main entry point)
- **main.py**: Command-line interface that uses `listed_cities.txt`
- **main_parallel.py**: Parallel execution script for multiple Chrome instances

### Configuration

- **config.py**: Centralized configuration (URLs, timeouts, CSS selectors, file paths)
- **cidades.txt**: Static reference file with all 852 MG cities
- **listed_cities.txt**: Dynamic file generated by GUI with selected cities

### Key Features

- **Sequential Processing**: One city at a time using single Chrome instance
- **Parallel Processing**: Multiple Chrome instances processing city subsets simultaneously  
- **Automatic Excel Generation**: Formatted output with colors (blue/red for credits/debits)
- **GUI Date Selection**: Pre-filled with current and previous month dates
- **Error Recovery**: Automatic browser management and graceful error handling

### File Structure

```
├── gui_main.py              # Main GUI application
├── main.py                  # CLI version
├── main_parallel.py         # Parallel execution
├── config.py                # Central configuration
├── classes/                 # Core modules
├── docs/                    # Documentation
├── cidades.txt             # Static city reference
├── listed_cities.txt       # Generated by GUI selection
└── arquivos_baixados/      # Output Excel files by date
```

### Data Flow

1. User selects cities via GUI or edits `listed_cities.txt`
2. DateCalculator provides date range (defaults to last month)
3. WebScrapingBot navigates BB website with Selenium
4. DataExtractor parses results and generates formatted Excel files
5. Files saved to `arquivos_baixados/YYYY-MM-DD/` directory

### Browser Requirements

- Google Chrome must be installed
- ChromeDriver managed automatically via webdriver-manager
- Headless mode available via config changes

### Testing & Validation

No automated tests present. Manual validation through:
- GUI city selection interface
- Date range validation (DD/MM/YYYY format)
- Chrome browser detection
- File permissions checking