# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Essential Commands

### Development
```bash
# Install dependencies
pip install -r requirements.txt

# Run main system (GUI interface - recommended)
python main.py

# Run in CLI mode with auto city detection
python main.py --cli [data_inicial] [data_final]

# Run parallel processing via CLI
python main.py --parallel [num_instances]

# Build executable using PyInstaller
pyinstaller main.spec

# Check dependencies (included in main.py)
python main.py  # includes dependency verification
```

### Virtual Environment
```bash
# Create virtual environment
python -m venv venv     # Windows
python3 -m venv venv    # macOS/Linux

# Activate virtual environment
source venv/bin/activate    # macOS/Linux
venv\Scripts\activate       # Windows
```

## Architecture Overview

This is a Python web scraping automation system with dual functionality:
1. **BB DAF**: Extracting FPM (Fundo de Participação dos Municípios) data from Banco do Brasil
2. **FNDE**: Scraping data from FNDE (Fundo Nacional de Desenvolvimento da Educação) system

The system was recently refactored for clear separation of concerns with dedicated folders for different responsibilities.

### Core Architecture

**System Entry Point**: `main.py` orchestrates the entire system, providing both GUI and CLI modes, and manages the dual-scraper interface.

**Business Logic Layer**: `src/bots/` directory contains the scraping engines:
- **BotBBDAF** (`src/bots/bot_bbdaf.py`): Complete BB DAF automation with single/parallel processing
- **BotFNDE** (`src/bots/bot_fnde.py`): FNDE system automation

**Utility Layer**: `src/classes/` directory contains shared utilities and configuration:
- **ProcessadorParalelo** (`src/classes/parallel_processor.py`): Manages parallel execution across instances
- **DataExtractor** (`src/classes/data_extractor.py`): HTML parsing and Excel generation with formatting
- **ChromeDriverSimples** (`src/classes/chrome_driver.py`): Direct ChromeDriver connection without webdriver-manager
- **Configuration** (`src/classes/config.py`): Centralized settings, CSS selectors, and constants

**UI Layer**: Separate GUI files for each scraper:
- **GUI1** (`src/view/gui1.py`): Pure UI for BB DAF system (parameter collection only)
- **GUI2** (`src/view/gui2.py`): Pure UI for FNDE system

### Key Architectural Principles

1. **Separation of Concerns**: Each layer has distinct responsibilities
2. **No Business Logic in UI**: GUIs only collect parameters and display results
3. **Unified Entry Point**: `main.py` composes and coordinates all components
4. **Parallel Processing**: Built-in support for multiple Chrome instances via ProcessadorParalelo
5. **Configuration Centralization**: All settings moved to `classes/config.py`

### Data Flow

**BB DAF Flow**:
1. User selects cities and dates via GUI1 or CLI
2. main.py creates BotBBDAF instance with DataExtractor
3. Bot handles complete automation: navigation → form filling → data extraction → Excel generation
4. Files saved to `arquivos_baixados/YYYY-MM-DD/` directory

**FNDE Flow**:
1. User selects year and municipality via GUI2
2. main.py creates BotFNDE instance
3. Bot processes FNDE website and generates data files
4. Files saved to `arquivos_baixados/fnde/` directory

**Parallel Processing Flow**:
1. ProcessadorParalelo divides cities into chunks
2. Multiple BotBBDAF instances run concurrently (threads or subprocesses)
3. Results are consolidated and reported

### File Organization

```
├── main.py                     # System orchestrator and entry point
├── main.spec                   # PyInstaller build specification
├── requirements.txt            # Python dependencies
├── src/                        # Source code directory
│   ├── view/                   # UI layer
│   │   ├── gui1.py            # BB DAF UI (parameters only)
│   │   └── gui2.py            # FNDE UI (parameters only)
│   ├── bots/                   # Business logic engines
│   │   ├── bot_bbdaf.py       # BB DAF complete automation logic
│   │   └── bot_fnde.py        # FNDE scraping logic
│   ├── classes/                # Shared utilities and config
│   │   ├── config.py          # Centralized configuration
│   │   ├── parallel_processor.py # Parallel execution manager
│   │   ├── chrome_driver.py   # Direct ChromeDriver connection
│   │   ├── data_extractor.py  # Excel generation and formatting
│   │   ├── date_calculator.py # Date range utilities
│   │   ├── file_manager.py    # File operations
│   │   ├── city_splitter.py   # City distribution for parallel processing
│   │   └── run_instance.py    # Helper for subprocess parallel execution
│   └── assets/                 # Static assets (icons, etc.)
├── cidades.txt                 # Static reference (852 MG cities)
├── listed_cities.txt           # Dynamic file generated by GUI
└── arquivos_baixados/          # Output directory organized by date/system
```

### Browser Requirements

- Google Chrome must be installed
- ChromeDriver is now connected directly (no webdriver-manager dependency)
- Direct connection improves reliability on macOS ARM64 systems

### Configuration Management

All configuration is centralized in `src/classes/config.py`:
- `SISTEMA_CONFIG`: URLs, timeouts, pauses
- `SELETORES_CSS`: CSS selectors for web elements
- `FNDE_CONFIG`: FNDE-specific settings
- `ARQUIVOS_CONFIG`: File paths and encoding

### Import Path Structure

The codebase uses a `src/` directory structure with automatic path resolution:

- **main.py** (root): Imports modules using `src.` prefix (e.g., `from src.view.gui1 import GUI1`)
- **Files within src/**: Use `sys.path.append()` to resolve imports to the root directory, then import with `src.` prefix
- **Key pattern**: Most files add three directory levels up to path: `sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))`

### Parallel Processing

Two modes available via ProcessadorParalelo:
1. **Thread-based**: Multiple BotBBDAF instances in threads (GUI mode)
2. **Subprocess-based**: Multiple Python processes (CLI mode)

### Testing & Validation

Manual validation through:
- GUI parameter validation (dates, city selection)
- Chrome browser detection at startup
- File permissions and directory creation
- Dependency verification in main.py